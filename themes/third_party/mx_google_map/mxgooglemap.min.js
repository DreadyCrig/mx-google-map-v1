$(function(){if($().mxgoogleMaps){}else{$.fn.mxgoogleMaps=function(e){var t=$.extend({},$.mxgoogleMaps.defaults,e);return this.each(function(){id_random=Math.floor(Math.random()*1e3+1);t.field_id=typeof t.field_id!="undefined"?t.field_id:id_random;$.mxgoogleMaps.gMap[t.field_id]=new google.maps.Map(this,t);google.maps.event.trigger($.mxgoogleMaps.gMap[t.field_id],"resize");$.mxgoogleMaps.geocoder=new google.maps.Geocoder;$.mxgoogleMaps.mapsConfiguration(t);if(t.cp){$.mxgoogleMaps.cp_ini(t)}})}}});$.mxgoogleMaps={cp_ini:function(e){google.maps.event.addListener($.mxgoogleMaps.gMap[e.field_id],"dragend",function(){$.mxgoogleMaps.set_field_data(e.field_id)});google.maps.event.addListener($.mxgoogleMaps.gMap[e.field_id],"zoom_changed",function(){$.mxgoogleMaps.set_field_data(e.field_id)});$("."+e.field_id+"_btn_geocode").click(function(){$.mxgoogleMaps.geocode_address(e.field_id)});$("."+e.field_id+"_btn_addmarker").click(function(){$.mxgoogleMaps.addmarker($.mxgoogleMaps.gMap[e.field_id].getCenter(),e.field_id,e.max_points,true,false,e.custom_fields)});$("."+e.field_id+"_btn_cmarker").click(function(){$.mxgoogleMaps.marker[e.field_id].setPosition($.mxgoogleMaps.gMap[e.field_id].getCenter())});$("#hold_"+e.field_id.replace("_id_","_")+" .hide_field span, .ui-droppable").click(function(){google.maps.event.trigger($.mxgoogleMaps.gMap[e.field_id],"resize")});$("."+e.field_id+"_btn_apply").click(function(){var t=$(this).attr("rel");var n=$.mxgoogleMaps.marker[$.mxgoogleMaps.activePoint[t]];var r=$("#gmap-icon_"+t).val();n.icon_name=r;n.setIcon(marker_icons_path+r);for(var i in e.custom_fields){$('input[name="'+t+"["+n.id+"]["+e.custom_fields[i].f_name+']"]').val($("#"+e.custom_fields[i].f_name+"_"+t).val())}$('input[name="'+t+"["+n.id+'][icon]"]').val($("#gmap-icon_"+t).val())});$("."+e.field_id+"_btn_move").click(function(){$.mxgoogleMaps.marker[$.mxgoogleMaps.activePoint[$(this).attr("rel")]].setPosition($.mxgoogleMaps.gMap[e.field_id].getCenter())});$("."+e.field_id+"_btn_delete").click(function(){$.mxgoogleMaps.max_points[$(this).attr("rel")]=$.mxgoogleMaps.max_points[$(this).attr("rel")]-1;$.mxgoogleMaps.marker[$.mxgoogleMaps.activePoint[$(this).attr("rel")]].setMap(null);$("#m"+$.mxgoogleMaps.activePoint[$(this).attr("rel")]).remove()})},mapsConfiguration:function(e){var t=$.mxgoogleMaps.mapLatLong(e.latitude,e.longitude);$.mxgoogleMaps.gMap[e.field_id].setCenter(t,e.zoom);if(e.markers){$.mxgoogleMaps.max_points[e.field_id]=0;$.mxgoogleMaps.icon[e.field_id]=e.icon;$.mxgoogleMaps.mapMarkers(t,e.markers,e.field_id,e.max_points,e.cp,e.custom_fields)}if(e.overlays){$.mxgoogleMaps.addOverlay(t,e.overlays,t,markers,e.cp)}if(e.custom_fields){field_list="";for(var n in e.custom_fields){field_list=field_list+'<label  for="'+e.custom_fields[n].f_name+'">'+e.custom_fields[n].label+"</label>";field_list=field_list+'<input autocomplete="off" spellcheck="false" id="'+e.custom_fields[n].f_name+"_"+e.field_id+'" name="'+e.custom_fields[n].f_name+'" type="text">'}$("#panel_main_el_"+e.field_id+" .custom_fields").html(field_list)}},directions:{},latitude:"",longitude:"",latlong:{},maps:{},marker:{},markers:{},max_points:{},infowindow:{},imageBounds:{},overlays:{},overlay:{},gMap:{},activePoint:{},geocoder:{},cp:false,field_id:"",icon:{},mapLatLong:function(e,t){return new google.maps.LatLng(e,t)},mapMarkers:function(e,t,n,r,s,o){if(typeof t.length=="undefined")t=[t];i=0;j=0;for(var u in t){$.mxgoogleMaps.addmarker(e,n,r,s,t[u],o)}},updateMarkerPosition:function(e,t,n){},addOverlay:function(e,t,n,r,i){},addmarker:function(e,t,n,r,i,s){if($.mxgoogleMaps.max_points[t]<n||!r){if(i){id=i.marker_id;$.mxgoogleMaps.marker[id]=new google.maps.Marker({position:new google.maps.LatLng(i.latitude,i.longitude),map:$.mxgoogleMaps.gMap[t],id:id,icon_name:i.icon,opts:i});if(typeof i.infow!="undefined"){$.mxgoogleMaps.infowindow[id]=new google.maps.InfoWindow({content:i.infow});google.maps.event.addListener($.mxgoogleMaps.marker[id],"click",function(){if($.mxgoogleMaps.lastClickedWindow!=null)$.mxgoogleMaps.infowindow[$.mxgoogleMaps.lastClickedWindow].close();$.mxgoogleMaps.lastClickedWindow=this.id;$.mxgoogleMaps.infowindow[this.id].open(this.map,this)})}if(r){$.mxgoogleMaps.add_hidden_fields(e,t,id,s);for(var o in s){$('input[name="'+t+"["+id+"]["+s[o].f_name+']"]').val(i[s[o].f_name])}$('input[name="'+t+"["+id+'][icon]"]').val(i.icon);$('input[name="'+t+"["+id+'][lat]"]').val(i.latitude);$('input[name="'+t+"["+id+'][long]"]').val(i.longitude)}if(i.icon!="default"&&i.icon!=""){$.mxgoogleMaps.marker[id].setIcon(marker_icons_path+i.icon)}}else{id=Math.floor(Math.random()*1e3+1);$.mxgoogleMaps.marker[id]=new google.maps.Marker({position:e,map:$.mxgoogleMaps.gMap[t],id:id,icon_name:$.mxgoogleMaps.icon[t]});if(r){$.mxgoogleMaps.add_hidden_fields(e,t,id,s);$.mxgoogleMaps.set_active_marker($.mxgoogleMaps.marker[id],t,s);if($.mxgoogleMaps.icon[t]!="default"&&$.mxgoogleMaps.icon[t]!=""){$.mxgoogleMaps.marker[id].setIcon(marker_icons_path+$.mxgoogleMaps.icon[t])}}}if(r){$.mxgoogleMaps.marker[id].setDraggable(true);google.maps.event.addListener($.mxgoogleMaps.marker[id],"dragend",function(){$.mxgoogleMaps.set_active_marker(this,t,s);$.mxgoogleMaps.set_input(this,t,s)});google.maps.event.addListener($.mxgoogleMaps.marker[id],"click",function(){$.mxgoogleMaps.set_active_marker(this,t,s);$.mxgoogleMaps.gMap[this.map.field_id].setCenter(this.getPosition());$.mxgoogleMaps.set_field_data(t)})}$.mxgoogleMaps.max_points[t]+=1}},lastClickedWindow:null,set_active_marker:function(e,t,n){$.mxgoogleMaps.updateMarkerPosition(e.getPosition(),t,$.mxgoogleMaps.gMap[t].getZoom());$.mxgoogleMaps.geocodePosition(e.getPosition(),t,n);$.mxgoogleMaps.activePoint[e.map.field_id]=e.id;$.mxgoogleMaps.set_input(e,t,n)},add_hidden_fields:function(e,t,n,r){fields="";for(var i in r){fields=fields+'<input name="'+t+"["+n+"]["+r[i].f_name+']"  type="hidden" />'}fields='<div id="m'+n+'"><input name="'+t+'[order][]"  value="'+n+'" />'+fields+'<input name="'+t+"["+n+'][long]" value="'+e.lng()+'"/><input name="'+t+"["+n+'][icon]" /><input name="'+t+"["+n+'][lat]" value="'+e.lat()+'"/> </div>';$("#"+t+"_data").append(fields)},set_field_data:function(e){center=$.mxgoogleMaps.gMap[e].getCenter();var t=center.lat()+"|"+center.lng()+"|"+$.mxgoogleMaps.gMap[e].getZoom();$('input[name="'+e+'[field_data]"]').val(t)},set_input:function(e,t,n){_icon_name=e.icon_name;center=e.getPosition();for(var r in n){$("#"+n[r].f_name+"_"+t).val($('input[name="'+t+"["+e.id+"]["+n[r].f_name+']"]').val())}$('input[name="'+t+"["+e.id+'][lat]"]').val(center.lat());$('input[name="'+t+"["+e.id+'][long]"]').val(center.lng());$("#latitude_"+t).val(center.lat());$("#longitude_"+t).val(center.lng());$("#gmap-icon_"+t).val(_icon_name)},geocode_address:function(e){var t=document.getElementById(e+"_address").value;$.mxgoogleMaps.geocoder.geocode({address:t,partialmatch:true},function(t,n){if(n=="OK"&&t.length>0){$.mxgoogleMaps.gMap[e].fitBounds(t[0].geometry.viewport);$.mxgoogleMaps.set_field_data(e);$.mxgoogleMaps.updateMarkerPosition(t[0].geometry.location,e,$.mxgoogleMaps.gMap[e].getZoom())}else{alert("Geocode was not successful for the following reason: "+n)}})},gCenter:function(e,t){e=typeof e!="undefined"?e:1;t=typeof t!="undefined"?t:20;var n={};for(var r in $.mxgoogleMaps.gMap){var n=new google.maps.LatLngBounds;pointCount=0;for(var i in $.mxgoogleMaps.marker){if($.mxgoogleMaps.marker[i].map.field_id==r){n.extend($.mxgoogleMaps.marker[i].position);pointCount++}}if(pointCount>0){$.mxgoogleMaps.gMap[r].fitBounds(n);zoom=$.mxgoogleMaps.gMap[r].getZoom();if(e>zoom){zoom=e}if(t<zoom){zoom=t}if($.mxgoogleMaps.gMap[r].getZoom()!=zoom){var s=google.maps.event.addListener($.mxgoogleMaps.gMap[r],"idle",function(){$.mxgoogleMaps.gMap[r].setZoom(zoom);google.maps.event.removeListener(s)})}}}},mUpdate:function(){for(var e in $.mxgoogleMaps.gMap){google.maps.event.trigger($.mxgoogleMaps.gMap[e],"resize")}},geocodePosition:function(e,t,n){$.mxgoogleMaps.geocoder.geocode({latLng:e},function(e){if(e&&e.length>0){$("#"+t+"_address").val(e[0].formatted_address);vvvv="";myAddress=[];myAddress["formatted_address"]=e[0].formatted_address;for(i=0;i<e[0].address_components.length;i++){for(j=0;j<e[0].address_components[i].types.length;j++){myAddress[e[0].address_components[i].types[j]+"_ln"]=e[0].address_components[i].long_name;myAddress[e[0].address_components[i].types[j]+"_sn"]=e[0].address_components[i].short_name}}var r=new RegExp(/{(.*?)}/);for(var s in n){if(n[s].pattern!=""){var o=n[s].pattern;for(patt in myAddress){o=o.replace("{"+patt+"}",myAddress[patt])}o=o.replace(r,"");$("#"+n[s].f_name+"_"+t).val(o)}}}else{alert("Cannot determine address at this location.")}})},defaults:{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:8,setDraggable:true,navigationControl:true,scaleControl:true,mapTypeControl:true,scrollwheel:true,max_points:1,cp:false,icon:"default"}}
